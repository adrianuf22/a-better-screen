#! /bin/sh

width=$1
height=$2
position=${position-0x0}
rotate=${rotate-normal}

while [ $# -gt 0 ]; do
    if [ -z "${1##*--*}" ]; then
        case $1 in
            --position)
                position=$2
                ;;
            --rotate)
                rotate=$2
        esac
    fi

    shift
done

printMessage() {
    # @Todo: Add debug flag to supress echo
    echo $1
}

createResolution() {
    vesaModeLine=$(cvt $width $height | grep Modeline | sed 's/Modeline //;s/_[0-9\.]*//;s/"//g')
    printMessage "$vesaModeLine"

    xrandr --newmode $vesaModeLine

    modeName=$(echo $vesaModeLine | awk '{ print $1 }')
    xrandr --addmode $output $modeName && printMessage "Resolution $modeName created!"
}

output=$(xrandr | grep ' connected ' | awk '{ print $1 }')
printMessage "Device: $output"

createResolution
if [ $? != '0' ]; then
    exit $?
fi

xrandr --dpi 192 --output $output --mode $modeName --pos $position --rotate $rotate && printMessage "Applied!!!"
